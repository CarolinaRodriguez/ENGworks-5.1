requires task.selection
REM *******************************************************************************
REM *     FUNCTION: Convert Decimal to Feet & Inch STRing
function MOD (N, D)
 dim tmp
 tmp=n - (rounddown(n / d, 0) * d)
 return tmp
end function
REM ******************************************************
function GCD(N1, N2)
   dim tmp
   while N1<>0
      tmp=n1
      n1=MOD(n2, n1)
      n2=tmp
   end while
   return n2
end function
REM ******************************************************
function FISTR(N, R)
   include "SILIB (MATH).COD"

   REM - Declare Variables
   dim S
   dim FT
   dim IN
   dim FR
   dim TN
   dim FRLEN
   dim FRGCD
   dim FRMUL
   dim RT

   REM - Store Number Sign and Convert To Positive for manipulation
   S = sign(N)
   N = N * S

   REM - Verify Rounding Argument is Positive
   R = R * sign(R)

   REM - Round Number Arguement (16 would round to nearest 1/16th inch)
   N = round(N*R,0)/R

   REM - Calculate Feet
   FT = rounddown(N/12,0)

   REM - Store Temp Number (minus feet)
   TN = N-(FT*12)

   REM - Calculate Inches
   IN = rounddown(TN,0)

   REM - Store Temp Number (minus full inches)
   TN = TN - IN

   REM - Save Fractional Decimal for Manipulation
   FR = TN

   REM - Determine Length of Fraction (note: "0." count as 2)
   REM - to calculate multiplier
   FRLEN = len(FR)
   if FRLEN = 3 then
      FRMUL = 10
   elseif FRLEN = 4 then
      FRMUL = 100
   elseif FRLEN = 5 then
      FRMUL = 1000
   elseif FRLEN = 6 then
      FRMUL = 10000
   else
      FRMUL = 0
   endif

   REM - Multiply Decimal by Proper Multiplier
   FR = FR * FRMUL
 
   REM - Calculate Greatest Common Divisor for Fraction Simplification
   FRGCD = GCD(FR, FRMUL)
 
   REM - Build Feet/Inch/Fraction String
   if FRMUL=0 then
      RT = FT*S + "' " + IN + ascii(34)
   else
      RT = FT*S + "' " + IN + "-" + FR/FRGCD + "/" + FRMUL/FRGCD + ascii(34)
   endif

   REM - Return to Calling Function
   return RT
end function
REM ******************************************************

dim UsrDatum = inputbox("Enter Elevation Datum (In Inches)")
if UsrDatum = "" then
   UsrDatum = 0
Endif

dim i = 1

while i <= task.selection.count
  dim item = task.selection[i]
 If item.servicetype = "Hanger" Then
  
  Dim BohElev = item.endlocation(1,"btm")
  Dim HangElev = BohElev - Usrdatum
  Item.customdata["Hanger Elev"].value = FISTR(HangElev, 8)
  item.update()
 Endif

      i = i + 1
end while




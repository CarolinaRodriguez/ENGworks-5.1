requires task.selection

REM Set count and weight to zero

dim HangerCount = 0
dim PipeWeight = 0
dim WaterWeight = 0



REM Count hangers in selection set
REM Calculate weight of total pipe length (CID 2014) and weight of fittings
REM Add other service types to the 'select' statement if required
REM WaterWeight Calculates weight of Water

dim i = 1

while i <= task.selection.count
  dim item = task.selection[i]
 
    select item.ServiceType
      case "Pipework"
        if item.CID=2041 Then 
			if item.customdata["Wet-Dry"].value = "Wet" then
				Dim R = item.dim[1].numvalue / 2
				Dim Vol = (R*R)*3.14159
				Dim Gal = Vol / 231
				dim WaterWeight = (Gal * 8.3454)*12
				PipeWeight=PipeWeight + ((item.weight + WaterWeight) * (item.dim["Length"].numvalue / 12))
			endif
			if item.customdata["Wet-Dry"].value = "Dry" then
				PipeWeight=PipeWeight + (item.weight * (item.dim["Length"].numvalue / 12))
			endif
        else
          PipeWeight=PipeWeight+Item.Weight
        endif
      case "Hanger"
        HangerCount=HangerCount+1
    endselect

  i = i + 1
endwhile

REM Calculate weight per hanger

dim WeightPerHanger = PipeWeight / HangerCount

REM Write weight per hanger into CustomData[1] for all hangers in selection set

i = 1

while i<=task.selection.count
  dim item = task.selection[i]

    if item.ServiceType = "Hanger" then
      item.CustomData[34].value = WeightPerHanger
      item.update()
    endif

  i=i+1
endwhile